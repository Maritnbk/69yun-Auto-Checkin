name: Daily Checkin

# 触发条件
on:
  schedule:
    # 定时运行：每天北京时间上午 8:30 运行一次 (UTC 00:30)
    # 这里的 cron 表达式使用 UTC 时间，+8 小时即为北京时间
    - cron: '30 0 * * *'
  workflow_dispatch:
    # 支持在 GitHub 界面手动点击 "Run workflow" 触发执行

jobs:
  checkin:
    runs-on: ubuntu-latest
    
    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 设置 Node.js 环境
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          # 如果你的项目有 package.json，可以开启缓存以加快速度
          # cache: 'npm'

      - name: 安装依赖
        # 如果你只使用了内置的 fetch (Node 18+)，这一步可以省略
        # 如果你有其他依赖，请取消下面行的注释
        # run: npm install
        run: echo "Using built-in fetch in Node 20"

      - name: 执行签到脚本
        env:
          # 从 GitHub Secrets 中安全读取变量并映射为环境变量
          DOMAIN: ${{ secrets.DOMAIN }}
          USER: ${{ secrets.USER }}
          PASS: ${{ secrets.PASS }}
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
          PUSHPLUS_TOPIC: ${{ secrets.PUSHPLUS_TOPIC }}
        run: node checkin.js
